kind: tools
name: list_invalid_indexes
type: postgres-sql
source: cloudsql-pg-source
description: Lists all invalid PostgreSQL indexes which are taking up disk space but are unusable by the query planner. Typically created by failed CREATE INDEX CONCURRENTLY operations.
statement: |
  SELECT
      nspname AS schema_name,
      indexrelid::regclass AS index_name,
      indrelid::regclass AS table_name,
      pg_size_pretty(pg_total_relation_size(indexrelid)) AS index_size,
      indisready,
      indisvalid,
      pg_get_indexdef(pg_class.oid) AS index_def
  FROM pg_index
  JOIN pg_class ON pg_class.oid = pg_index.indexrelid
  JOIN pg_namespace ON pg_namespace.oid = pg_class.relnamespace
  WHERE indisvalid = FALSE;
authRequired: []
parameters: []
templateParameters: []
---
kind: sources
name: cloudsql-pg-source
type: cloud-sql-postgres
project: twisha-dev
region: us-central1
instance: sdk-testing
ipType: public
database: inventory
user: postgres
password: TestPassword1@
